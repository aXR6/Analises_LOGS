{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">Tr√°fego de Rede</h2>
<div id="net-list" class="list-group"></div>
<script>
const LABEL_COLORS = {{ label_colors | tojson }};
function labelClass(name) {
  const key = name.toLowerCase();
  return LABEL_COLORS[key] || '';
}
async function fetchNetwork(page=1) {
  const resp = await fetch('/api/network?page=' + page);
  if (!resp.ok) return;
  const data = await resp.json();
  const list = document.getElementById('net-list');
  list.innerHTML = '';
  for (const row of data.events) {
    const item = document.createElement('div');
    item.className = 'list-group-item small';
    if (row[3].toLowerCase() !== 'normal') {
      item.classList.add('list-group-item-danger');
    }
    item.innerHTML = `
        <div class="d-flex flex-wrap gap-2">
          <span><strong>ID:</strong> ${row[0]}</span>
          <span><strong>${row[1]}</strong></span>
        </div>
        <div class="d-flex flex-wrap gap-2">
          <span class="${labelClass(row[3])}"><strong>${row[3]}</strong></span>
          <span><strong>Score:</strong> ${row[4].toFixed(2)}</span>
        </div>
        <div class="text-break">${row[2]}</div>`;
    list.appendChild(item);
  }
}
fetchNetwork();
setInterval(fetchNetwork, 5000);
</script>
{% endblock %}
