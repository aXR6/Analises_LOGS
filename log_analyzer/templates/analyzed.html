{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">Registros Analisados</h2>
<h5>Logs</h5>
<div id="analyzed-log-list" class="list-group mb-4"></div>
<h5>Pacotes de Rede</h5>
<div id="analyzed-net-list" class="list-group"></div>
<script>
async function fetchAnalyzed(page=1) {
  const respLogs = await fetch('/api/analyzed?page='+page);
  const respNet = await fetch('/api/analyzed_network?page='+page);
  if (!respLogs.ok || !respNet.ok) return;
  const dataLogs = await respLogs.json();
  const dataNet = await respNet.json();
  const listLogs = document.getElementById('analyzed-log-list');
  const listNet = document.getElementById('analyzed-net-list');
  listLogs.innerHTML = '';
  listNet.innerHTML = '';
  for (const row of dataLogs.logs) {
    const item = document.createElement('div');
    item.className = 'list-group-item small';
    item.innerHTML = `
        <div><strong>ID Original:</strong> ${row[0]} - <strong>${row[1]}</strong></div>
        <div class="d-flex flex-wrap gap-2">
          <span><strong>Programa:</strong> ${row[3]}</span>
          <span><strong>Severidade:</strong> ${row[6]}</span>
          <span><strong>Anomalia:</strong> ${row[7].toFixed(2)}</span>
        </div>
        <div class="text-break">${row[4]}</div>
        <div class="mt-1"><strong>Resumo:</strong> ${row[10]}</div>`;
    listLogs.appendChild(item);
  }
  for (const row of dataNet.events) {
    const item = document.createElement('div');
    item.className = 'list-group-item small';
    item.innerHTML = `
        <div><strong>ID Evento:</strong> ${row[0]} - <strong>${row[1]}</strong></div>
        <div class="d-flex flex-wrap gap-2">
          <span><strong>Modulo:</strong> ${row[5] || 'desconhecido'}</span>
          <span><strong>Classificação:</strong> ${row[3]}</span>
          <span><strong>Score:</strong> ${row[4].toFixed(2)}</span>
        </div>
        <div class="text-break">${row[2]}</div>
        <div class="mt-1"><strong>Resumo:</strong> ${row[6]}</div>`;
    listNet.appendChild(item);
  }
}
fetchAnalyzed();
</script>
{% endblock %}
